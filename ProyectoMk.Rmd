---
title: Reporte técnico
output: html_document
---

Karina Ibarra 136608, Daniela Ordoñez 136977, Andres Albores 131749

#IntroducciÃ³n

###Violencia intrafamiliar (plantamiento del problema)

Violencia intrafamiliar es un tipo de abuso que puede incluir violencia fisica, violencia sexual, amenazas de violencia o abuso emocional. Su origen es debatido por muchos aunque se cree que las principales causas son falta de recursos econÃ³micos, el abuso del alcohol y la drogadicciÃ³n, asociados comÃºnmente con la pobreza.

Fuente:
http://www.violenciaenlafamilia.conapo.gob.mx/en/Violencia_Familiar/Violencia_en_la_Familia

### Base de datos utilizada y descripcion de datos

Los datos en los que nos basamos para nuestra investigaciÃ³n se obtuvieron de la DirecciÃ³n General de Epidemiologia de la Secretaria de Salud durante el perido de 2003 a 2014

La informaciÃ³n esta dividida en:

 -Casos reportados por fuentes: muestra el nÃºmero total de victimas por entidad federativa, reportado por las principales instituciones de salud.

 -Casos por grupo de Edad: Presenta el nÃºmero total de victimas por entidad federativa, reportado para los grupos de edad establecidos.

 -Casos de ocurrencia por mes: Presenta el nÃºmero total de victimas, por entidad federativa, reportado por mes.

Asimismo, para cada uno de estos tres grandes grupos la informaciÃ³n se divide en tres categorias segÃºn gÃ©nero: Femenino, Masculino y ambos.

**Nota:** Las categorias utilizadas para cada uno de los tres grandes grupos se presentan en el diccionario adjunto. 

### Del Presente Documento
En este documento se presenta una anÃ¡lisis de los casos presentados de violencia domestica,durante el periodo 2003-2014, basado en los datos registrados por la DirecciÃ³n General de EpidemiologÃ?a de la Secretaria de Salud. En este se presenta, en una primera parte los problemas que se plantean para ser resueltos mediante el anÃ¡lisis; posteriormente se describe cÃ³mo es que se han obtenido los datos y con quÃ© medios se ha realizado la obtenciÃ³n de los mismas,asimismo, se realiza una breve descripciÃ³n de los datos y con base a esta se define el alcance y lÃ?mite de los datos; ulteriormente se transforman los datos obtenidos a formatos que permitan una mejor manipulaciÃ³n de los mismos y faciliten su analisis; en seguida se realizan pruebas de calidad sobre los datos de transformados;procedemos despuÃ©s a realizar el anÃ¡lisis exploratorio de los datos con el objetivo de resolver los problemas que se plantearon en un inicio y , finalmente, se se presentan las conclusiones para el trabajo realizado.

#DefiniciÃ³n del Problema

En el presente documento nos proponemos identificar cuÃ¡les son las Ã©pocas en que se debe prestar mayor atenciÃ³n al fenÃ³meno, cuÃ¡l es la tendencia del fenÃ³meno, cuÃ¡les son las instituciones que atienden un mayor nÃºmero de casos, quÃ© entidades y quÃ© grupos de edad y quÃ© sexo son mÃ¡s vulnerables al fenÃ³meno para mejorar el apoyo que se brinda a las vÃ?ctimas y las acciones preventivas que se toman en cada estado.

#ObtenciÃ³n de datos

http://www.epidemiologia.salud.gob.mx/anuario/html/anuarios.html

### De los Recursos Utilizados

Los datos empleados para el anÃ¡lisis fueron obtenidos de la pagina http://www.epidemiologia.salud.gob.mx/anuario/html/anuarios.html, la informaciÃ³n fue obtenida en formato pdf y transformada mediante el programa "Tabula" a formato csv para facilitar el anÃ¡lisis (para mayor informaciÃ³n sobre el programa visite http://tabula.technology/). El anÃ¡lisis de los datos se realizÃ³ en "RStudio", la informaciÃ³n tÃ©cnica de este Ãºltimo se presenta a continuaciÃ³n:


```{r Directorio}
directorio <- "C:/Users/Andres/OneDrive/Tenth Semester/Estadística Aplicada I/GitHub/EA1"
setwd(directorio)
knitr::opts_knit$set(root.dir = directorio)
```

```{r Informacion Session, echo=FALSE}
sessionInfo()
```

## Realizamos la lectura de los datos

```{r LecturaValores, echo=FALSE}

library(plyr)
###FUENTE
violencia.fuente <- NULL 
titulos.fuente <- NULL
for (i in 1:12){ 
violencia.fuente[[i]] <- read.csv(paste("./Datos/BrutosCSV/Fuente/FueFem",i+2002,".csv", sep = "" ), sep = ",", stringsAsFactors = FALSE, encoding = "UTF-8")
titulos.fuente[i] <- paste("FueFem",i+2002,sep="")
}

for (i in 1:12){
violencia.fuente[[i+12]] <- read.csv(paste("./Datos/BrutosCSV/Fuente/FueGen",i+2002,".csv",sep=""), sep = ",", stringsAsFactors=FALSE, encoding = "UTF-8")
titulos.fuente[i+12] <- paste("FueGen",i+2002,sep="")
}

for (i in 1:12){
violencia.fuente[[i+24]] <- read.csv(paste("./Datos/BrutosCSV/Fuente/FueMas",i+2002,".csv",sep=""), sep = ",", stringsAsFactors=FALSE, encoding = "UTF-8")
titulos.fuente[i+24] <- paste("FueMas",i+2002,sep="")
}
names(violencia.fuente) <- titulos.fuente

###EDAD
violencia.edad <- NULL
titulos.edad <- NULL
for (i in 1:12){
violencia.edad[[i]] <- read.csv(paste("./Datos/BrutosCSV/Grupo/GruFem",i+2002,".csv",sep=""),stringsAsFactors=FALSE)
titulos.edad[i] <- paste("GruFem",i+2002,sep="")
}

for (i in 1:12){
violencia.edad[[i+12]] <- read.csv(paste("./Datos/BrutosCSV/Grupo/GruGen",i+2002,".csv",sep=""),stringsAsFactors=FALSE)
titulos.edad[i+12] <- paste("GruGen",i+2002,sep="")
}

for (i in 1:12){
violencia.edad[[i+24]] <- read.csv(paste("./Datos/BrutosCSV/Grupo/GruMas",i+2002,".csv",sep=""),stringsAsFactors=FALSE)
titulos.edad[i+24] <- paste("GruMas",i+2002,sep="")
}
names(violencia.edad) <- titulos.edad

###MES
violencia.mes <- NULL 
titulos.mes <- NULL
for (i in 1:12){ 
violencia.mes[[i]] <- read.csv(paste("./Datos/BrutosCSV/Mes/MesFem",i+2002,".csv", sep = "" ), stringsAsFactors = FALSE)
titulos.mes[i] <- paste("MesFem",i+2002,sep="")
 }

for (i in 1:12){
violencia.mes[[i+12]] <- read.csv(paste("./Datos/BrutosCSV/Mes/MesGen",i+2002,".csv",sep=""),stringsAsFactors=FALSE)
titulos.mes[i+12] <- paste("MesGen",i+2002,sep="")
}

for (i in 1:12){
violencia.mes[[i+24]] <- read.csv(paste("./Datos/BrutosCSV/Mes/MesMas",i+2002,".csv",sep=""),stringsAsFactors=FALSE)
titulos.mes[i+24] <- paste("MesMas",i+2002,sep="")
}
names(violencia.mes) <- titulos.mes
```

## Limpieza de datos

```{r Edicion}
##FUENTE
for (i in 1:36){ 
names(violencia.fuente[[i]]) <-toupper(names(violencia.fuente[[i]]))
}

for (i in 1:36){ 
names(violencia.fuente[[i]]) <-gsub("SEDEMAR","SEMAR",names(violencia.fuente[[i]]))
}

for (i in 1:36){ 
names(violencia.fuente[[i]]) <-gsub("SALUD","SSA",names(violencia.fuente[[i]]))
}

##EDAD
for (i in 1:36){ 
names(violencia.edad[[i]]) <- c("Estado","Menor a 1","1 a 4","5 a 9", "10 a 14","15 a 19", "20 a 24","25 a 44", "45 a 49","50 a 59","60 a 64","65 o Mas","Desconocida")
}
for (i in 1:36){ 
names(violencia.edad[[i]]) <-toupper(names(violencia.edad[[i]]))
}

##MES
for (i in 1:36){ 
names(violencia.mes[[i]]) <-toupper(names(violencia.mes[[i]]))
}
```

##Guardamos la informacion en 3 grupos de DATA.

````{r SaveData}
##FUENTE
violencia.intrafamiliar.fuente <- ldply(violencia.fuente,data.frame)
violencia.intrafamiliar.fuente <- violencia.intrafamiliar.fuente[,1:12]
save(violencia.intrafamiliar.fuente, file="violencia_intrafamiliar_Fuente.RData")

##EDAD
violencia.intrafamiliar.edad <- ldply(violencia.edad,data.frame)
violencia.intrafamiliar.edad <- violencia.intrafamiliar.edad[,1:14]
save(violencia.intrafamiliar.edad, file="violencia_intrafamiliar_Edad.RData")

##MES
violencia.intrafamiliar.mes <- ldply(violencia.mes,data.frame)
violencia.intrafamiliar.mes <- violencia.intrafamiliar.mes[,1:15]
save(violencia.intrafamiliar.mes, file="violencia_intrafamiliar_Mes.RData")
```

##Se consolido la informacion en 3 grupos: violencia.intrafamiliar.fuente, violencia.intrafamiliar.grupo, violencia.intrafamiliar.mes. A continuacion se presenta un extracto de cada uno de ellos:

*Reporte de casos de violencia por Fuente/Institucion*
```{r, echo=FALSE}
head(violencia.intrafamiliar.fuente)
```

*Reporte de casos de violencia por Grupo de Edad*
```{r, echo=FALSE}
head(violencia.intrafamiliar.edad)
```

*Reporte de casos de violencia por Mes*
```{r, echo=FALSE}
head(violencia.intrafamiliar.mes)
```


##Se presenta la estructura de los archivos consolidados y las variables de cada uno.

*Reporte de casos de violencia por Fuente/Institucion*
```{r, echo=FALSE}
str(violencia.intrafamiliar.fuente)
```

*Reporte de casos de violencia por Grupo de Edad*
```{r, echo=FALSE}
str(violencia.intrafamiliar.edad)
```

*Reporte de casos de violencia por Mes*
```{r, echo=FALSE}
str(violencia.intrafamiliar.mes)
```

##Limpieza de los datos despues de la carga

##Se introducen dos nuevas variables: Sexo y Periodo.
##Se elimina la variable .id en cada DATA.
```{r Sexo y Periodo}
##FUENTE
violencia.intrafamiliar.fuente$PERIODO <- factor(substr(violencia.intrafamiliar.fuente$.id,7,10), ordered=TRUE)
violencia.intrafamiliar.fuente$SEXO <- factor(substr(violencia.intrafamiliar.fuente$.id,4,4))
violencia.intrafamiliar.fuente$.id <- NULL
violencia.intrafamiliar.fuente <- within(violencia.intrafamiliar.fuente,{
 SEXO <- gsub("M","Masculino",SEXO,fixed=TRUE)
 SEXO <- gsub("F","Femenino",SEXO,fixed=TRUE)
 SEXO <- gsub("G","General",SEXO,fixed=TRUE)
 })

save(violencia.intrafamiliar.fuente, file="violencia_intrafamiliar_Fuente(Sexo-Periodo).RData")

##EDAD
violencia.intrafamiliar.edad$PERIODO <- factor(substr(violencia.intrafamiliar.edad$.id,7,10), ordered=TRUE)
violencia.intrafamiliar.edad$SEXO <- factor(substr(violencia.intrafamiliar.edad$.id,4,4))
violencia.intrafamiliar.edad$.id <- NULL
violencia.intrafamiliar.edad <- within(violencia.intrafamiliar.edad,{
 SEXO <- gsub("M","Masculino",SEXO,fixed=TRUE)
 SEXO <- gsub("F","Femenino",SEXO,fixed=TRUE)
 SEXO <- gsub("G","General",SEXO,fixed=TRUE)
 })

save(violencia.intrafamiliar.edad, file="violencia_intrafamiliar_Edad(Sexo-Periodo).RData")

##MES
violencia.intrafamiliar.mes$PERIODO <- factor(substr(violencia.intrafamiliar.mes$.id,7,10), ordered=TRUE)
violencia.intrafamiliar.mes$SEXO <- factor(substr(violencia.intrafamiliar.mes$.id,4,4))
violencia.intrafamiliar.mes$.id <- NULL
violencia.intrafamiliar.mes <- within(violencia.intrafamiliar.mes,{
 SEXO <- gsub("M","Masculino",SEXO,fixed=TRUE)
 SEXO <- gsub("F","Femenino",SEXO,fixed=TRUE)
 SEXO <- gsub("G","General",SEXO,fixed=TRUE)
 })

save(violencia.intrafamiliar.mes, file="violencia_intrafamiliar_Mes(Sexo-Periodo).RData")
```

##Convertimos las variables a tipo nominal
```{r Variable Nominal, echo=FALSE}

#FUENTE
violencia.intrafamiliar.fuente$ESTADO <- factor(violencia.intrafamiliar.fuente$ESTADO)
violencia.intrafamiliar.fuente$SEXO <- factor(violencia.intrafamiliar.fuente$SEXO)

save(violencia.intrafamiliar.fuente,file="violencia_Fuente_Limp.RData")

#EDAD
violencia.intrafamiliar.edad$ESTADO <- factor(violencia.intrafamiliar.edad$ESTADO)
violencia.intrafamiliar.edad$SEXO <- factor(violencia.intrafamiliar.edad$SEXO)

save(violencia.intrafamiliar.edad,file="violencia_Edad_Limp.RData")


#MES
violencia.intrafamiliar.mes$ESTADO <- factor(violencia.intrafamiliar.mes$ESTADO)
violencia.intrafamiliar.mes$SEXO <- factor(violencia.intrafamiliar.mes$SEXO)

save(violencia.intrafamiliar.mes,file="violencia_Mes_Limp.RData")

```


##Quitamos los espacios entre numeros
```{r Quitar Espacios, echo=FALSE }
##FUENTE
violencia.intrafamiliar.fuente <- within(violencia.intrafamiliar.fuente, {
   SSA <- gsub("\\s+|,","",SSA)
   IMSS.ORD <- gsub("\\s+|,","",IMSS.ORD)
   ISSSTE <- gsub("\\s+|,","",ISSSTE)
   IMSS.OP <- gsub("\\s+|,","",IMSS.OP)
   DIF <- gsub("\\s+|,","",DIF)
   PEMEX <- gsub("\\s+|,","",PEMEX)
   SEDENA <- gsub("\\s+|,","",SEDENA)
   SEMAR <- gsub("\\s+|,","",SEMAR)
   OTRAS <- gsub("\\s+|,","",OTRAS)
 })

##EDAD
violencia.intrafamiliar.edad <- within(violencia.intrafamiliar.edad,{
 MENOR.A.1 <- gsub("\\s+|,","",MENOR.A.1)
 X1.A.4 <- gsub("\\s+|,|,","",X1.A.4)
 X5.A.9 <- gsub("\\s+|,","",X5.A.9)
 X10.A.14 <- gsub("\\s+|,","",X10.A.14)
 X15.A.19 <- gsub("\\s+|,","",X15.A.19)
 X20.A.24 <- gsub("\\s+|,","",X20.A.24)
 X25.A.44 <- gsub("\\s+|,","",X25.A.44)
 X45.A.49 <- gsub("\\s+|,","",X45.A.49)
 X50.A.59 <- gsub("\\s+|,","",X50.A.59)
 X60.A.64 <- gsub("\\s+|,","",X60.A.64)
 X65.O.MAS <- gsub("\\s+|,","",X65.O.MAS)
 DESCONOCIDA <- gsub("\\s+|,","",DESCONOCIDA) 
})

##MES

violencia.intrafamiliar.mes <- within(violencia.intrafamiliar.mes, {
   ENE <- gsub("\\s+|,","",ENE)
   FEB <- gsub("\\s+|,","",FEB)
   MAR <- gsub("\\s+|,","",MAR)
   ABR <- gsub("\\s+|,","",ABR)
   MAY <- gsub("\\s+|,","",MAY)
   JUN <- gsub("\\s+|,","",JUN)
   JUL <- gsub("\\s+|,","",JUL)
   AGO <- gsub("\\s+|,","",AGO)
   SEP <- gsub("\\s+|,","",SEP)
   OCT <- gsub("\\s+|,","",OCT)
   NOV <- gsub("\\s+|,","",NOV)
   DIC <- gsub("\\s+|,","",DIC)
 })

```

### Sustituimos los valores nulos por NA

```{r}

# FUENTE
violencia.intrafamiliar.fuente <- within(violencia.intrafamiliar.fuente, {
     SSA <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",SSA)
     IMSS.ORD <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",IMSS.ORD)
     ISSSTE <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",ISSSTE)
     IMSS.OP <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",IMSS.OP)
     DIF <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",DIF)
     PEMEX <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",PEMEX)
     SEDENA <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",SEDENA)
     SEMAR <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",SEMAR)
     OTRAS <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",OTRAS)
     })

# MES
violencia.intrafamiliar.mes <- within(violencia.intrafamiliar.mes, {
     ENE <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",ENE)
     FEB <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",FEB)
     MAR <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",MAR)
     ABR <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",ABR)
     MAY <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",MAY)
     JUN <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",JUN)
     JUL <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",JUL)
     AGO <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",AGO)
     SEP <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",SEP)
     OCT <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",OCT)
     NOV <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",NOV)
     DIC <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",DIC)
     })

# EDAD
violencia.intrafamiliar.edad <- within(violencia.intrafamiliar.edad, {
     MENOR.A.1 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",MENOR.A.1)
     X1.A.4 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X1.A.4)
     X5.A.9 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X5.A.9)
     X10.A.14 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X10.A.14)
     X15.A.19 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X15.A.19)
     X20.A.24 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X20.A.24)
     X25.A.44 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X25.A.44)
     X45.A.49 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X45.A.49)
     X50.A.59 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X50.A.59)
     X60.A.64 <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X60.A.64)
     X65.O.MAS <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",X65.O.MAS)
     DESCONOCIDA <- gsub("[S.R.,S/R,N.A.,N/A]{1,}","NA",DESCONOCIDA)
     })

```


##Convertimos a numerico los datos
```{r Numeric, echo=FALSE ,warning=FALSE}

##FUENTE
violencia.intrafamiliar.fuente <- within(violencia.intrafamiliar.fuente, {
 SSA <- as.numeric(SSA)
 IMSS.ORD <- as.numeric(IMSS.ORD)
 ISSSTE <- as.numeric(ISSSTE)
 IMSS.OP <- as.numeric(IMSS.OP)
 DIF <- as.numeric(DIF)
 PEMEX <- as.numeric(PEMEX)
 SEDENA <- as.numeric(SEDENA)
 SEMAR <- as.numeric(SEMAR)
 OTRAS <- as.numeric(OTRAS)
})

##MES
violencia.intrafamiliar.mes <- within(violencia.intrafamiliar.mes, {
  ENE <- as.numeric(ENE)
  FEB <- as.numeric(FEB)
  MAR <- as.numeric(MAR)
  ABR <- as.numeric(ABR)
  MAY <- as.numeric(MAY)
  JUN <- as.numeric(JUN)
  JUL <- as.numeric(JUL)
  AGO <- as.numeric(AGO)
  SEP <- as.numeric(SEP)
  OCT <- as.numeric(OCT)
  NOV <- as.numeric(NOV)
  DIC <- as.numeric(DIC)
})

##EDAD
violencia.intrafamiliar.edad <- within(violencia.intrafamiliar.edad,{  
 MENOR.A.1 <- as.numeric(MENOR.A.1)
 X1.A.4 <- as.numeric(X1.A.4)
 X5.A.9 <- as.numeric(X5.A.9)
 X10.A.14 <- as.numeric(X10.A.14)
 X15.A.19 <- as.numeric(X15.A.19)
 X20.A.24 <- as.numeric(X20.A.24)
 X25.A.44<- as.numeric(X25.A.44)
 X45.A.49 <- as.numeric(X45.A.49)
 X50.A.59 <- as.numeric(X50.A.59)
 X60.A.64 <- as.numeric(X60.A.64)
 X65.O.MAS<- as.numeric(X65.O.MAS)
 DESCONOCIDA <- as.numeric(DESCONOCIDA)
})

```

## Se introduce la columna TOTAL, que suma las columnas de cada fila.
```{r ColumnaTotal}

##FUENTE
FUENTE <- violencia.intrafamiliar.fuente[,c(-1,-11,-12,-13)]
violencia.intrafamiliar.fuente$TOTAL <- apply(FUENTE,1,function(x) sum(x, na.rm=TRUE))

##MES
MES <- violencia.intrafamiliar.mes[,c(-1,-2,-15,-16)]
violencia.intrafamiliar.mes$TOTAL <- apply(MES,1,function(x) sum(x,na.rm=TRUE))

##EDAD
EDAD<-violencia.intrafamiliar.edad[,c(-1,-14,-15)]
violencia.intrafamiliar.edad$TOTAL <- apply(EDAD,1,function(x) sum(x,na.rm=TRUE))

```


## Con los cambios anteriores, la estructura de las 3 bases de datos queda de la siguiente manera.

*Reporte de casos de violencia por Fuente/Institucion*
```{r, echo=FALSE}
str(violencia.intrafamiliar.fuente)
```

*Reporte de casos de violencia por Grupo de Edad*
```{r, echo=FALSE}
str(violencia.intrafamiliar.edad)
```

*Reporte de casos de violencia por Mes*
```{r, echo=FALSE}
str(violencia.intrafamiliar.mes)
```

### Valores Faltantes

Como primer control revisamos los valores faltantes en las tres bases de datos.

*Registros Nulos violencia intrafamiliar Por Fuente/Institucion*
```{r Registros Nulos Fuente, echo=FALSE}
sum(is.na(violencia.intrafamiliar.fuente))
```

*Registros Nulos violencia intrafamiliar Por Edad*
```{r Registros Nulos Edad, echo=FALSE}
sum(is.na(violencia.intrafamiliar.edad))
```

*Registros Nulos violencia intrafamiliar Por Mes*
```{r Registros Nulos Mes, echo=FALSE}
sum(is.na(violencia.intrafamiliar.mes))
```

*Validacion Reporte Casos violencia  Por Fuente*
```{r ValidacionFuente, echo=FALSE}
mujeresf.periodo <-  aggregate(TOTAL~PERIODO,data=subset(violencia.intrafamiliar.fuente, SEXO=="Femenino"),sum) 
colnames(mujeresf.periodo) <- c("Periodo","Femenino")

hombresf.periodo <- aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.fuente, SEXO=="Masculino"),sum)
colnames(hombresf.periodo) <- c("Periodo","Masculino")

generalf.periodo <- aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.fuente, SEXO=="General"),sum)
colnames(generalf.periodo) <- c("Periodo","General")

#Se crearon 3 tablas con la suma de casos por periodo para los diferentes textos (femenino, masculino y general)
verificacion.fuente <- merge(merge(generalf.periodo,hombresf.periodo),mujeresf.periodo)

#Se juntan las 3 tablas en una sola
verificacion.fuente$Validacion <- as.list(rowSums(subset(verificacion.fuente,TRUE,c(Masculino,Femenino)),na.rm=FALSE))

#Se agrega una columna con la suma de la columna Femenino y Masculino
save(verificacion.fuente,file="Validacion_Fuente.RData")

#Se presenta la tabla creada
verificacion.fuente
```

*Validacion Reporte Casos violencia  Por Mes*
```{r VerificacionMes, echo=FALSE}
mujeresm.periodo <-  aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.mes, SEXO=="Femenino"),sum)
colnames(mujeresm.periodo) <- c("Periodo","Femenino")

hombresm.periodo <- aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.mes, SEXO=="Masculino"),sum)
colnames(hombresm.periodo) <- c("Periodo","Masculino")

generalm.periodo <- aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.mes, SEXO=="General"),sum)
colnames(generalm.periodo) <- c("Periodo","General")

#Se crearon 3 tablas con la suma de casos por periodo para los diferentes textos (femenino, masculino y general)
verificacion.mes <- merge(merge(generalm.periodo,hombresm.periodo),mujeresm.periodo)

#Se juntan las 3 tablas en una sola
verificacion.mes$Validacion <- as.list(rowSums(subset(verificacion.mes,TRUE,c(Masculino,Femenino)),na.rm=FALSE))

#Se agrega una columna con la suma de la columna Femenino y Masculino
save(verificacion.mes,file="Validacion_Mes.RData")

#Se presenta la tabla creada
verificacion.mes

```

*Validacion Reporte Casos violencia  Por Edad*

```{r VerificacionEdad, echo=FALSE}

mujerese.periodo <-  aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.edad, SEXO=="Femenino"),sum)
colnames(mujerese.periodo) <- c("Periodo","Femenino")

hombrese.periodo <- aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.edad, SEXO=="Masculino"),sum)
colnames(hombrese.periodo) <- c("Periodo","Masculino")

generale.periodo <- aggregate(TOTAL~ PERIODO,data=subset(violencia.intrafamiliar.edad, SEXO=="General"),sum)
colnames(generale.periodo) <- c("Periodo","General")

#Se crearon 3 tablas con la suma de casos por periodo para los diferentes textos (femenino, masculino y general)
verificacion.edad <- merge(merge(generale.periodo,hombrese.periodo),mujerese.periodo)

#Se juntan las 3 tablas en una sola
verificacion.edad$Validacion <- as.list(rowSums(subset(verificacion.edad,TRUE,c(Masculino,Femenino)),na.rm=FALSE))

#Se agrega una columna con la suma de la columna Femenino y Masculino
save(verificacion.edad,file="Validacion_Edad.RData")

#Se presenta la tabla creada
verificacion.edad

```

### Resumen de los Datos
```{r Resumen de los Datos, echo=FALSE}
###FUENTE
summary(violencia.intrafamiliar.fuente)

###EDAD
summary(violencia.intrafamiliar.edad)

###MES
summary(violencia.intrafamiliar.mes)
```

Aqui termina la limpieza principal de los datos

```{r CambioFormato, echo=FALSE}
library(reshape2)
violencia.intrafamiliar.estado <- 
violencia.intrafamiliar.fuente$TOTAL <- NULL
violencia.intrafamiliar.edad$TOTAL <- NULL
violencia.intrafamiliar.mes$TOTAL <- NULL

#Cambiamos el formato a la base violencia.intrafamiliar.fuente

violencia.intrafamiliar.FUENTE <- melt(data=violencia.intrafamiliar.fuente,id=c("ESTADO","PERIODO","SEXO"))
names(violencia.intrafamiliar.FUENTE) <- c("ESTADO","PERIODO","SEXO","INSTITUCION","CASOS")

save(violencia.intrafamiliar.FUENTE, file="violencia_FLargo_Fuente.RData")

#Cambiamos el formato a la base violencia.intrafamiliar.mes

violencia.intrafamiliar.MES <- melt(data=violencia.intrafamiliar.mes,id=c("ESTADO","PERIODO","SEXO"),na.rm=TRUE)
names(violencia.intrafamiliar.MES) <- c("ESTADO","PERIODO","SEXO","MES","CASOS")

save(violencia.intrafamiliar.MES, file="violencia_FLargo_Mes.RData")


#Cambiamos el formato a la base violencia.intrafamiliar.edad

violencia.intrafamiliar.EDAD <- melt(data=violencia.intrafamiliar.edad,id=c("ESTADO","PERIODO","SEXO"))
names(violencia.intrafamiliar.EDAD) <- c("ESTADO","PERIODO","SEXO","EDAD","CASOS")

save(violencia.intrafamiliar.EDAD,file="violencia_FLargo_Edad.RData")

```


```{r tipo de variables y extracto, echo=FALSE}
##FUENTE
str(violencia.intrafamiliar.FUENTE)
head(violencia.intrafamiliar.FUENTE)

##MES
str(violencia.intrafamiliar.MES)
head(violencia.intrafamiliar.MES)

##EDAD
str(violencia.intrafamiliar.EDAD)
head(violencia.intrafamiliar.EDAD)
```

```{r TablaAuxFuente ,echo=FALSE}

institucion.per <- NULL

#Generamos la Tabla
periodo <- c(2003:2014)
for (i in 1:12){
  institucion.per[[i]] <- as.list(colSums(subset(violencia.intrafamiliar.fuente,PERIODO==periodo[i] & SEXO=="General")[,2:10]),na.rm=TRUE)
}

names(institucion.per) <- periodo

institucion.periodo <- ldply(institucion.per,data.frame)

names(institucion.periodo) <- c("PERIODO","SSA","IMSS.ORD","ISSSTE","IMSS.OP","DIF","PEMEX","SEDENA","SEMAR","OTRAS")

#La pasamos al formato largo

INSTITUCION.PERIODO <- melt(institucion.periodo,id=c("PERIODO"))

names(INSTITUCION.PERIODO) <- c("PERIODO","INSTITUCION","CASOS")

save(INSTITUCION.PERIODO, file="Total de Casos Por Institucion.RData")

INSTITUCION.PERIODO

```

Utilizando la tabla, se elabora la siguiente gr??fica, mostrando en ella la tendencia por del n??mero de incidentes reportado instituci??n , durante el periodo de observaci??n.

```{r Grafica1Fuente, echo=FALSE}

library(ggplot2)

ggplot(INSTITUCION.PERIODO,aes(PERIODO,CASOS,group=INSTITUCION))+geom_line(aes(colour=INSTITUCION)) +facet_wrap(~INSTITUCION,ncol=3)+ geom_point(aes(colour=INSTITUCION))+labs(title="Casos reportados por institucion (2003-2014)",x="Periodo",y="Numero de casos")+theme_bw()+theme(axis.text.x=element_text(angle=90))+theme(legend.position="none",strip.text = element_text(face = "bold"),axis.text.x = element_text(size=15), axis.text.y = element_text(size=15),strip.background = element_blank(),axis.text = element_text(colour=grey(.50)),axis.ticks=element_line(colour=grey(.80)),axis.title = element_text(colour=grey(.45), size=12), plot.title = element_text(size =20))

```

###Instituci??n con Mayor N??mero de Reportes

Utilizando la tabla anteriormente expuesta, se realizará la siguiente gr??fica, que muestra el n??mero total de reportes por instituci??n durante cada a??o, esto con el fin de identificar la instituci??n que genera un mayor n??mero de reportes en cada uno de los a??os de observaci??n.

En esta tabla es f??cil ver que la instituci??n que recibe un mayor n??mero de reportes de violencia intrafamiliar  es la Secretar??a de Salud, siendo esta la que realiza un mayor n??mero de reportes por a??o.

```{r Grafica2Fuente, echo=FALSE}

ggplot(INSTITUCION.PERIODO,aes(x=INSTITUCION,y=CASOS,group=PERIODO,fill=INSTITUCION)) +geom_bar(stat="identity",aes(colour=INSTITUCION))+facet_wrap(~PERIODO,ncol=3)+theme_bw()+theme(axis.text.x=element_text(angle=90,size=5),strip.text = element_text(face = "bold"),strip.background = element_blank(),axis.text = element_text(colour=grey(.50)),axis.ticks=element_line(colour=grey(.80)),axis.text.x = element_text(size=15), axis.text.y = element_text(size=15),axis.title = element_text(colour=grey(.45)))+labs(title="Casos por Institucion reportados cada periodo",x="Institucion",y="Numero de Casos", plot.title = element_text(size =20))

```


###Tendencia Interanual N??mero de incidentes de violencia intrafamiliar

Buscando identificar la ??poca del a??o en que se registra un mayor n??mero de incidentes de violencia domestica e identificar el comportamiento interanual que tiene el fen??meno se crea la siguiente tabla, ??sta muestra el n??mero total  de incidentes de violencia domestica por cada a??o dentro del periodo de observaci??n; la tabla fue creada utilizando los datos generales, para cada uno de los periodos, sumando el n??mero de incidentes reportado para las diferentes entidades.

```{r CreacionTablaAuxiliarMes, echo=FALSE}

mes.per <- NULL
periodo <- c(2003:2014)

#Generamos la tabla

for (i in 1:12){
  mes.per[[i]] <- as.list(colSums(subset(violencia.intrafamiliar.mes,PERIODO==periodo[i] & SEXO=="General")[,2:13]),na.rm=TRUE)
}

names(mes.per) <- periodo

mes.periodo <- ldply(mes.per,data.frame)

names(mes.periodo) <- c("Periodo","ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC")

#Converitmos la tabla a formato largo
MES.PERIODO <- melt(mes.periodo,id=c("Periodo"),na.rm=TRUE)

#Renombramos variables
names(MES.PERIODO) <- c("Periodo","Mes","No.incidentes")

save(MES.PERIODO, file="Tendencia Interanual.RData")

MES.PERIODO
```

Gr??ficamente presentamos la tendencia interanual, para cada uno de los a??os de observaci??n, de incidentes de violencia intrafamiliar en la siguiente gr??fica.

```{r Grafica1Mes, echo=FALSE}

ggplot(MES.PERIODO,aes(x=Mes,y=No.incidentes,group=Periodo))+geom_line(aes(colour=Periodo))+geom_point(aes(colour=Periodo),size=2.5)+facet_wrap(~Periodo,ncol=3)+theme_bw()+theme(strip.text = element_text(face = "bold"),strip.background = element_blank(),axis.text = element_text(colour=grey(.50)),axis.ticks=element_line(colour=grey(.80)),axis.title = element_text(colour=grey(.45)), axis.text.x = element_text(size=15, angle=45,vjust=.5), axis.text.y = element_text(size=15, angle=45),plot.title = element_text(size =20))+labs(title="Evolucion anual de los casos reportados de violencia intrafamiliar",x="Mes",y="Numero de incidentes")+theme(legend.position="none")+scale_x_discrete("Mes",labels=c("ENE"="Enero","FEB"="Febrero","MAR"="Marzo","ABR"="Abril","MAY"="Mayo","JUN"="Junio","JUL"="Julio","AGO"="Agosto","SEP"="Septiembre","OCT"="Octubre","NOV"="Noviembre","DIC"="Diciembre"))

```

###Tendencia Mensual vs Media Mensual (2003-2014)

Considernado importante identificar la tendencia mensual del n??mero de incidentes reportadas durante los a??os de observaci??n y creyendo necesario identificar como referencia el n??mero promedio de incidentes reportado de manera mensual se crea la siguiente tabla generando el n??mero promedio de incidentes por mes.


```{r Tabla Medias Mensual, echo=FALSE}

#Creamos una tabla con las medias de cada mes

media.mes.1 <- as.data.frame(sapply(mes.periodo[,2:13],mean))
media.mes.1$Mes <- c("ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC")
names(media.mes.1) <- c("No.incidentes","Mes")

save(media.mes.1, file="Promedio incidentes Mensual.RData")

media.mes.1
```

En la siguiente gr??fica se presenta la tendencia mensual del n??mero total de incidentes a trav??s de los a??os de observaci??n, comparada con la media para el periodo identificada para cada mes.

```{r Grafica2Mes, echo=FALSE}
#grafica
ggplot(MES.PERIODO,aes(x=Periodo,y=No.incidentes,group=Mes))+geom_line(aes(colour=Mes))+geom_point(aes(colour=Mes),size=2.5)+facet_wrap(~Mes,ncol=4)+theme_bw()+theme(strip.text = element_text(face = "bold"),strip.background = element_blank(),axis.text = element_text(colour=grey(.50)),axis.text.x = element_text(size=15, angle=45,vjust=.5),axis.text.y = element_text(size=15, angle=45),plot.title = element_text(size =20),axis.ticks=element_line(colour=grey(.80)),axis.title = element_text(colour=grey(.45)))+labs(title="Tendencia mensual por periodo de observacion comparada con la media del mes",x="Mes",y="Numero de incidentes")+theme(legend.position="none")+geom_hline(data=media.mes.1,aes(yintercept=No.incidentes,group=Mes),linetype=2)+ scale_colour_hue(h=c(180, 270))

```

Asimismo, utilizando la tabla generada que contiene el promedio de incidentes, mostramos los promedios mensuales de casos registrados.  

```{r PromedioBarPlot, echo=FALSE}

color.prom <- c(NA,NA,NA,NA, "withcolor", NA, NA,NA,NA,NA,NA,NA)

ggplot(media.mes.1,aes(x=Mes,y=No.incidentes,fill=color.prom))+geom_bar(stat="identity")+theme_bw()+theme(strip.text = element_text(face = "bold"),strip.background = element_blank(),axis.text = element_text(colour=grey(.50)),axis.text.x = element_text(size=15, angle=45,vjust=.5),axis.text.y = element_text(size=15, angle=45),plot.title = element_text(size =20),axis.ticks=element_line(colour=grey(.80)),axis.title = element_text(colour=grey(.45)))+labs(title="Promedio Mensual de casos de violencia intrafamiliar",x="Mes",y="Numero de incidentes")+theme(legend.position="none")+xlim("ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC")
```

```{r ChisteSecreto, echo = FALSE}

# What's purple, round and doesn't go to work?

# A non-abelian grape (it doesn't commute)

```

